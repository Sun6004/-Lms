<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="kr.or.hku.student.mapper.FacilityMapper">
 	
 	<!-- 사물함 리스트 가져오기 -->
 	<select id="lockerList" resultType="lockerVO" parameterType="map">
 	/*kr.or.hku.student.mapper.FacilityMapper.lockerList*/
	 	SELECT 
	 		  a.locker_no
	 		, a.floor
	 		, a.flct_no
	 		, a.avl_cd 
		FROM locker a
		WHERE flct_no LIKE #{fcltNo}
		AND floor = #{floor}
 	</select>
 	
 	<!-- 내가 예약한 사물함이 있는지 체크! -->
 	<select id="lockerReservationCheck" parameterType="lockerRsvtVO" resultType="int">
 	/*kr.or.hku.student.mapper.FacilityMapper.lockerReservationCheck*/
	 	SELECT COUNT(*) FROM locker_rsvt
		WHERE std_no = #{stdNo}
		AND locker_yr = #{lockerYr}
		AND rsvt_sem = #{rsvtSem}
 	</select>
 	
 	<!-- 사물함 사용 여부 Y로 바꾸기 -->
 	<update id="lockerYnUpdate" parameterType="lockerRsvtVO">
 	/*kr.or.hku.student.mapper.FacilityMapper.lockerYnUpdate*/
 		UPDATE locker
 		SET
 			avl_cd = 'Y'
 		WHERE locker_no = #{lockerNo}
 		AND floor = #{floor}
 		AND flct_no = #{flctNo}
 	</update>
 	
 	<!-- 사물함 예약테이블에 insert -->
 	<insert id="lockerReservation" parameterType="lockerRsvtVO">
 	/*kr.or.hku.student.mapper.FacilityMapper.lockerReservation*/
 		INSERT INTO locker_rsvt
 		VALUES(seq_locker_rsvt.nextval, #{lockerNo}, #{floor}, #{flctNo}, #{stdNo}, #{lockerYr}, #{rsvtSem}, 'N') 
 	</insert>
 	
 	<!-- 해당 시설의 시설물 리스트 가져오기 -->
 	<select id="fcltsList" resultType="flctsVO" parameterType="map">
 	/*kr.or.hku.student.mapper.FacilityMapper.fcltsList*/
	 	SELECT 
	 		  a.flct_no     	/*시설번호*/
	 		, a.flct_nm			/*시설이름*/
	 		, b.flcts_nm		/*시설물이름*/
	 		, b.flcts_no		/*시설물번호*/
		FROM facility a
		LEFT OUTER JOIN facilities b ON(a.flct_no = b.flct_no)
		WHERE a.flct_no LIKE #{flctNo}
		ORDER BY b.flcts_nm
 	</select>
 	
 	<!-- 해당 시설에대한 시간테이블 가져오기 -->
 	<select id="rsvtList" parameterType="map" resultType="flctsVO">
 	/*kr.or.hku.student.mapper.FacilityMapper.rsvtList*/
	 	SELECT 
	 		  a.flcts_no
	 		, a.flct_no
	 		, a.flcts_nm
	 		, b.flcts_rsvt_no
	 		, b.std_no
	 		, b.rsvt_date
	 		, b.start_hours
	 		, b.end_hours
	 		, b.use_users
	 		, b.use_prps
		FROM facilities a
		LEFT OUTER JOIN facillities_rsvt b ON(a.flcts_no = b.flcts_no)
		WHERE a.flct_no = #{flctNo}
		AND b.rsvt_date = #{rsvtDate}
 	</select>
 	 	<!-- 예약 신청할때 이미 해당 시간 예약 한것이 있느지 체크 -->
 	 	
 	<!-- <select id="flctsReservationCheck" parameterType=""flctsVO"">
 	/*kr.or.hku.student.mapper.FacilityMapper.flctsReservationCheck*/
 	</select>
 	 -->
 	<!-- 예약 신청하기 -->
 	<insert id="flctsReservation" parameterType="flctsVO">
 	/*kr.or.hku.student.mapper.FacilityMapper.flctsReservation*/
 		INSERT INTO facillities_rsvt
 		VALUES(seq_facilities_rsvt.nextval, #{flctsNo}, #{stdNo}, #{rsvtDate}, #{startHours}, #{endHours}, #{useUsers}, #{usePrps})
 	</insert>
 	
 </mapper>