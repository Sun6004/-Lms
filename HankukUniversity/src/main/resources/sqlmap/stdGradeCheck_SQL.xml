<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="kr.or.hku.student.mapper.StdGradeCheckMapper">
 	<select id="getStudentInfo" parameterType="String" resultType="stdInfoVO">
 		SELECT 
        A.STD_NO
        ,STD_NM
        ,D.SUB_CRD
        ,E.DEPT_NM
        ,F.COL_NM
        ,G.COM_CD_NM AS CRS_CLASSF_NM
        ,H.COM_CD_NM AS STD_STTS_NM
        FROM STUDENT A
        JOIN COURSE_REGIST B ON A.STD_NO = B.STD_NO
        JOIN LECTURE_APLY C ON B.LECAP_NO = C.LECAP_NO
        JOIN SUBJECT D ON C.SUB_NO = D.SUB_NO
        JOIN DEPARTMENT E ON A.DEPT_CD = E.DEPT_CD
        JOIN COLLEGE F ON E.COL_CD = F.COL_CD
        JOIN COM_CODE G ON D.CRS_CLASSF_CD = G.COM_CD
        JOIN COM_CODE H ON A.STD_STTS_CD = H.COM_CD
        WHERE A.STD_NO = '20220004'
        AND C.LECAP_YR = EXTRACT(YEAR FROM SYSDATE)
		AND C.LECAP_SEM = CASE
		    WHEN EXTRACT(MONTH FROM SYSDATE) = 6 THEN '1'
		    ELSE '2'
        END
 	</select>
 	
 	<select id="getSubjectInfo" parameterType="String" resultType="subjectVO">
 		  SELECT
			    b.sub_no,
			    c.sub_nm,
			    c.sub_crd,
			    d.com_cd_nm AS crs_classf_cd,
			    b.lecap_no
			FROM
			    course_regist a
			    JOIN lecture_aply b ON a.lecap_no = b.lecap_no
			    JOIN subject c ON b.sub_no = c.sub_no
			    JOIN com_code d ON c.crs_classf_cd = d.com_cd
			WHERE
			    std_no = #{stdNo}
			    AND   b.lecap_yr = EXTRACT(YEAR FROM SYSDATE)
			    AND   b.lecap_sem =
			        CASE
			            WHEN EXTRACT(MONTH FROM SYSDATE) = 6 THEN '1'
			            ELSE '2'
        			END
 	</select>
 	
 	<update id="submitobjections" parameterType="courseRegistVO">
		UPDATE COURSE_REGIST
		SET GRD_DMR_CN = #{grdDmrCn},
		    GRD_DMR_STTS_CD = 'wait'
		WHERE STD_NO = #{stdNo}
		AND LECAP_NO = #{lecapNo}
 	</update>
 	
 
 </mapper>